# run_sql_in_bq.py

  run_sql_in_bq.pyは、コピペで使えます。
  
  SQLファイルをまとめたフォルダから、一つずつすべてのSQLファイルを読み込み、BigQuery(※以下BQ)上で実行・結果をcsv保存します。
  
  csv保存が不要な場合は、簡単なアレンジですぐに分析へシフトできます。

## 処理の流れ

  ※★印は自分の環境のパスを指定する箇所です。コピペ後に変更してご使用ください。
  
  
  1.Google認証を通す(BQの初期設定は済ませてある前提です)
  
  2.GoogleDrive・共有ドライブのマウント取得
  
  　　∟ ※ブラウザでGoogleログイン認証が求められるので対応する
    
   　　　(ローカルの場合不要なため削除してもOK) 
   
  3.BQプロジェクトを指定
  
  4.SQLファイルが入ったフォルダパスを取得★
  
  　　∟ フォルダパスはGoogleドライブのURLでも可
   
  5.csv化した結果を保存するフォルダパスを取得★
  
  　　∟ フォルダパスはGoogleドライブのURLでも可
   
  6.SQLファイル内のコードを、変数に格納
  
  　　∟ 1SQLファイルにつき、1つのSQLが理想的です
    
  　　∟ SQLファイル以外の拡張子ファイルがあっても大丈夫です
   
  7.SQL実行後の結果を格納するデータフレームを定義
  
  8.pandas経由で変数に入れたSQLをBQに流し、結果をさっき定義したデータフレームに保存
  
  9.データフレームをcsvとして指定のフォルダに保存
  
  10.以上の6～9の処理をすべてのSQLファイルのSQLを実行するまでループ



## 必要要件
  
  - 要件1.Google Cloud SDKでBQの初期設定が済んでいる
  - 要件2.windowsでのみテスト済
  - 要件3.インストールが必要なPythonライブラリ
  - 　∟ google-cloud-bigquery、google-cloud、google-cloud-storage、pydata-google-auth、pandas-gbq

## 使い方
  
  1. 作業フォルダを用意し、以下の手順をこのディレクトリ下で行う
  2. .sqlファイルを用意し、1フォルダにまとめておく
  
  　　∟ SQL例：『SELECT * FROM BQテーブル名 WHERE 条件』
  
  3. 実行結果csvを保存するフォルダを用意する
  
  4. 本.pyファイルをコピーするか、自分のコードにコピペする
  
  5. ★印箇所を適宜変更する
  
  6. インストールが必要なPythonライブラリ(前述)をインストールしておく(済の場合飛ばす)
 
  　　∟ コード冒頭にコマンドを記載しています
  
  7. 本Pythonコードを実行


## その他

  特になし

## 作者

  mail to: mmatsumotogit@gmail.com
